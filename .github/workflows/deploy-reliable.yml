# å¯é çš„ GitHub Pages éƒ¨ç½²å·¥ä½œæµ
# ä½¿ç”¨ peaceiris/actions-gh-pages ç¡®ä¿éƒ¨ç½²æˆåŠŸ
# ä½œè€…: 9531lyj

name: ğŸš€ å¯é éƒ¨ç½²åˆ° GitHub Pages

# è§¦å‘æ¡ä»¶
on:
  # æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  push:
    branches: [ main ]
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

# è®¾ç½®æƒé™
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  # æ„å»ºå’Œéƒ¨ç½²ä½œä¸š
  deploy:
    name: ğŸ”¨ æ„å»ºå¹¶éƒ¨ç½²
    runs-on: ubuntu-latest
    
    steps:
    # æ­¥éª¤1: æ£€å‡ºä»£ç 
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    # æ­¥éª¤2: è®¾ç½® Node.js ç¯å¢ƒ
    - name: ğŸŸ¢ è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    # æ­¥éª¤3: å®‰è£…ä¾èµ–
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        echo "ğŸ” æ£€æŸ¥é¡¹ç›®ä¿¡æ¯..."
        echo "é¡¹ç›®åç§°: $(cat package.json | grep '"name"' | head -1)"
        echo "é¡¹ç›®ç‰ˆæœ¬: $(cat package.json | grep '"version"' | head -1)"
        echo "ğŸ“¦ å¼€å§‹å®‰è£…ä¾èµ–..."
        npm ci
        echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"
    
    # æ­¥éª¤4: TypeScript ç±»å‹æ£€æŸ¥
    - name: ğŸ” TypeScript ç±»å‹æ£€æŸ¥
      run: |
        echo "ğŸ” è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥..."
        npm run type-check
        echo "âœ… ç±»å‹æ£€æŸ¥é€šè¿‡"
    
    # æ­¥éª¤5: æ„å»ºé¡¹ç›®
    - name: ğŸ—ï¸ æ„å»ºé¡¹ç›®
      env:
        NODE_ENV: production
      run: |
        echo "ğŸ—ï¸ å¼€å§‹æ„å»ºç”Ÿäº§ç‰ˆæœ¬..."
        npm run build
        echo "âœ… æ„å»ºå®Œæˆ"
        echo "ğŸ“Š æ„å»ºäº§ç‰©ä¿¡æ¯:"
        ls -la dist/
        du -sh dist/
        echo "ğŸ“ ä¸»è¦æ–‡ä»¶:"
        find dist/ -name "*.html" -o -name "*.js" -o -name "*.css" | head -10
    
    # æ­¥éª¤6: éƒ¨ç½²åˆ° GitHub Pages
    - name: ğŸš€ éƒ¨ç½²åˆ° GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        publish_branch: gh-pages
        user_name: '9531lyj'
        user_email: '2233613389@qq.com'
        commit_message: |
          ğŸš€ Deploy Space Battle Game v2.0
          
          âœ¨ æ–°åŠŸèƒ½:
          - æ•Œæœºå‡»æ¯æ•ˆæœä¼˜åŒ–
          - UIå¸ƒå±€æ”¹è¿›
          - æ§åˆ¶è¯´æ˜ç§»è‡³å³ä¸Šè§’
          
          ğŸ“… éƒ¨ç½²æ—¶é—´: ${{ github.event.head_commit.timestamp }}
          ğŸ“ æäº¤: ${{ github.sha }}
          ğŸ‘¨â€ğŸ’» ä½œè€…: 9531lyj
        force_orphan: true
        enable_jekyll: false
        cname: false
    
    # æ­¥éª¤7: éƒ¨ç½²æˆåŠŸé€šçŸ¥
    - name: ğŸ‰ éƒ¨ç½²æˆåŠŸé€šçŸ¥
      run: |
        echo "ğŸ‰ å¤ªç©ºæˆ˜æ–—æ¸¸æˆéƒ¨ç½²æˆåŠŸï¼"
        echo "ğŸŒ æ¸¸æˆåœ°å€: https://9531lyj.github.io/space-battle-game/"
        echo "ğŸ“… éƒ¨ç½²æ—¶é—´: $(date)"
        echo "ğŸ”— GitHub ä»“åº“: https://github.com/${{ github.repository }}"
        echo "ğŸ‘¨â€ğŸ’» ä½œè€…: 9531lyj"
        echo "ğŸ“§ é‚®ç®±: 2233613389@qq.com"
        echo ""
        echo "ğŸ® æ¸¸æˆç‰¹æ€§:"
        echo "  âœ¨ 3Då¤ªç©ºæˆ˜æ–—ä½“éªŒ"
        echo "  ğŸ¯ ç„å‡†é•œç³»ç»Ÿ"
        echo "  âš¡ æŠ€èƒ½ç³»ç»Ÿ"
        echo "  ğŸ’¥ æ•Œæœºå‡»æ¯æ•ˆæœ"
        echo "  ğŸš€ ç²’å­ç‰¹æ•ˆ"
        echo "  ğŸ¨ åŠ¨æ€å…‰ç…§"
        echo ""
        echo "ğŸ® ç«‹å³å¼€å§‹æ¸¸æˆ: https://9531lyj.github.io/space-battle-game/"
        echo ""
        echo "ğŸ“‹ æ¸¸æˆæ§åˆ¶:"
        echo "  WASD - ç§»åŠ¨é£æœº"
        echo "  ç©ºæ ¼ - å‘å°„ç‚®å¼¹"
        echo "  å³é”® - ç„å‡†æ¨¡å¼"
        echo "  1234 - ä½¿ç”¨æŠ€èƒ½"
        echo ""
        echo "ğŸ¯ æ–°å¢å‡»æ¯æ•ˆæœ:"
        echo "  ğŸ’¥ æ™®é€šç‚®å¼¹ - æ ‡å‡†çˆ†ç‚¸"
        echo "  âš¡ æ¿€å…‰æ­¦å™¨ - èƒ½é‡çˆ†å‘"
        echo "  ğŸš€ å¯¼å¼¹æ­¦å™¨ - å¤§çˆ†ç‚¸å†²å‡»æ³¢"
